## ä¸€ã€å¸¸ç”¨é«˜çº§å‡½æ•°

```python
import numpy as np
import pandas as pd
import tensorflow as tf
from matplotlib import pyplot as plt
from mpl_toolkits.mplot3d import Axes3D

# ä¸€ã€tf.gather
# 1.æ”¶é›†å•ä¸€ç»´åº¦æ•°æ®
x = tf.random.uniform([4,35,8],maxval=100,dtype=tf.int32) # æˆç»©å†Œå¼ é‡
print(x.shape)
print((tf.gather(x,[0,1],axis=0)).shape) # åœ¨ç­çº§ç»´åº¦æ”¶é›†ç¬¬ 1~2 å·ç­çº§æˆç»©å†Œ
print((tf.gather(x,[0,3,8,11,12,26],axis=1)).shape) # åœ¨å­¦ç”Ÿç»´åº¦æ”¶é›†ç¬¬ 1,4,9,12,13,27 å·åŒå­¦æˆç»©
print()

# 2.æ”¶é›†ç­çº§å’Œå­¦ç”Ÿç»´åº¦æ•°æ®
students=tf.gather(x,[1,2],axis=0) # æ”¶é›†ç¬¬ 2,3 å·ç­çº§
print((tf.gather(students,[2,3,5,26],axis=1)).shape) # æ”¶é›†ç¬¬ 3,4,6,27 å·åŒå­¦

# äºŒã€tf.gather_nd
#æŠ½å‡ºäº†ç­çº§ 1 çš„å­¦ç”Ÿ 1 çš„ç§‘ç›® 2ã€ç­çº§ 2 çš„å­¦ç”Ÿ 2 çš„ç§‘ç›® 3ã€ç­çº§ 3 çš„å­¦ç”Ÿ 3 çš„ç§‘ç›® 4 çš„æˆç»©
x = tf.random.uniform([4,35,8],maxval=100,dtype=tf.int32) # æˆç»©å†Œå¼ é‡
print(tf.gather_nd(x,[[1,1,2],[2,2,3],[3,3,4]])) 

# ä¸‰ã€tf.boolean_mask

#é‡‡æ ·ç¬¬ 1ã€4ã€5ã€8 é—¨ç§‘ç›®
x = tf.random.uniform([4,35,8],maxval=100,dtype=tf.int32) # æˆç»©å†Œå¼ é‡
print(tf.boolean_mask(x,mask=[True,False,False,True,True,False,False,True],axis=2).shape)

# å››ã€tf.where
'''
é€šè¿‡ tf.where(cond, a, b)æ“ä½œå¯ä»¥æ ¹æ® cond æ¡ä»¶çš„çœŸå‡ä»å‚æ•°ğ‘¨æˆ–ğ‘©ä¸­è¯»å–æ•°æ®ï¼Œæ¡ä»¶
åˆ¤å®šè§„åˆ™å¦‚ä¸‹ï¼š
ğ‘œğ‘– = {ğ‘ğ‘– condğ‘–ä¸º Trueï¼Œğ‘ğ‘– condğ‘–ä¸º False}
å…¶ä¸­ğ‘–ä¸ºå¼ é‡çš„å…ƒç´ ç´¢å¼•ï¼Œè¿”å›çš„å¼ é‡å¤§å°ä¸ğ‘¨å’Œğ‘©ä¸€è‡´ï¼Œå½“å¯¹åº”ä½ç½®çš„condğ‘–ä¸º Trueï¼Œğ‘œğ‘–ä»
ğ‘ğ‘–ä¸­å¤åˆ¶æ•°æ®ï¼›å½“å¯¹åº”ä½ç½®çš„condğ‘–ä¸º Falseï¼Œğ‘œğ‘–ä»ğ‘ğ‘–ä¸­å¤åˆ¶æ•°æ®ã€‚è€ƒè™‘ä» 2 ä¸ªå…¨ 1 å’Œå…¨ 0 çš„
3 Ã— 3å¤§å°çš„å¼ é‡ğ‘¨å’Œğ‘©ä¸­æå–æ•°æ®ï¼Œå…¶ä¸­condğ‘–ä¸º True çš„ä½ç½®ä»ğ‘¨ä¸­å¯¹åº”ä½ç½®æå–å…ƒç´  1ï¼Œ
condğ‘–ä¸º False çš„ä½ç½®ä»ğ‘©å¯¹åº”ä½ç½®æå–å…ƒç´  0ï¼Œä»£ç å¦‚ä¸‹
'''
# 1.å‚æ•° a!=b!=None
a = tf.ones([3,3]) # æ„é€  a ä¸ºå…¨ 1 çŸ©é˜µ
b = tf.zeros([3,3]) # æ„é€  b ä¸ºå…¨ 0 çŸ©é˜µ
cond = tf.constant([[True,False,False],[False,True,False],[True,True,False]]) # æ„é€ é‡‡æ ·æ¡ä»¶
print(tf.where(cond,a,b)) # æ ¹æ®æ¡ä»¶ä» a,b ä¸­é‡‡æ ·
print()

# 2.å‚æ•° a=b=None
# a å’Œ b å‚æ•°ä¸æŒ‡å®šï¼Œtf.where ä¼šè¿”å› cond å¼ é‡ä¸­æ‰€æœ‰ True çš„å…ƒç´ çš„ç´¢å¼•åæ ‡
print(tf.where(cond))

# äº”ã€tf.scatter_nd(indices, updates, shape)
# æ„é€ éœ€è¦å†™å…¥çš„æ•°æ®ï¼Œ4 å·ä½å†™å…¥ 4.4,3 å·ä½å†™å…¥ 3.3ï¼Œä»¥æ­¤ç±»æ¨
indices = tf.constant([[4], [3], [1], [7]])

# åœ¨é•¿åº¦ä¸º 8 çš„å…¨ 0 å‘é‡ä¸Šæ ¹æ® indices å†™å…¥ updates æ•°æ®
updates = tf.constant([4.4, 3.3, 1.1, 7.7])

print(indices)
print()
print(updates)
print()
print(tf.scatter_nd(indices, updates, [8]))

# å…­ã€tf.meshgrid
x = tf.linspace(-8.,8,100) # è®¾ç½® x è½´çš„é‡‡æ ·ç‚¹
y = tf.linspace(-8.,8,100) # è®¾ç½® y è½´çš„é‡‡æ ·ç‚¹
x,y = tf.meshgrid(x,y) # ç”Ÿæˆç½‘æ ¼ç‚¹ï¼Œå¹¶å†…éƒ¨æ‹†åˆ†åè¿”å›
z = tf.sqrt(x**2+y**2)
z = tf.sin(z)/z # sinc å‡½æ•°å®ç°
fig = plt.figure()
ax = Axes3D(fig) # è®¾ç½® 3D åæ ‡è½´
# æ ¹æ®ç½‘æ ¼ç‚¹ç»˜åˆ¶ sinc å‡½æ•° 3D æ›²é¢
ax.contour3D(x.numpy(), y.numpy(), z.numpy(), 50)
plt.show()
```

## äºŒã€ç»å…¸æ•°æ®é›†åŠ è½½

```python
import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import datasets # å¯¼å…¥ç»å…¸æ•°æ®é›†åŠ è½½æ¨¡å—

# åŠ è½½ MNIST æ•°æ®é›†
(x, y), (x_test, y_test) = datasets.mnist.load_data()
train_db = tf.data.Dataset.from_tensor_slices((x, y)) # æ„å»º Dataset å¯¹è±¡

# 1.éšæœºæ‰“æ•£
train_db = train_db.shuffle(10000) # éšæœºæ‰“æ•£æ ·æœ¬ï¼Œä¸ä¼šæ‰“ä¹±æ ·æœ¬ä¸æ ‡ç­¾æ˜ å°„å…³ç³»

# 2.æ‰¹è®­ç»ƒ
train_db = train_db.batch(128) # è®¾ç½®æ‰¹è®­ç»ƒï¼Œbatch size ä¸º 128

# 3.é¢„å¤„ç†
# é¢„å¤„ç†å‡½æ•°å®ç°åœ¨ preprocess å‡½æ•°ä¸­ï¼Œä¼ å…¥å‡½æ•°åå³å¯
train_db = train_db.map(preprocess)
def preprocess(x, y): # è‡ªå®šä¹‰çš„é¢„å¤„ç†å‡½æ•°
# è°ƒç”¨æ­¤å‡½æ•°æ—¶ä¼šè‡ªåŠ¨ä¼ å…¥ x,y å¯¹è±¡ï¼Œshape ä¸º[b, 28, 28], [b]
 # æ ‡å‡†åŒ–åˆ° 0~1
 x = tf.cast(x, dtype=tf.float32) / 255.
 x = tf.reshape(x, [-1, 28*28]) # æ‰“å¹³
 y = tf.cast(y, dtype=tf.int32) # è½¬æˆæ•´å‹å¼ é‡
 y = tf.one_hot(y, depth=10) # one-hot ç¼–ç 
 # è¿”å›çš„ x,y å°†æ›¿æ¢ä¼ å…¥çš„ x,y å‚æ•°ï¼Œä»è€Œå®ç°æ•°æ®çš„é¢„å¤„ç†åŠŸèƒ½
 return x,y

# 4.å¾ªç¯è®­ç»ƒ
train_db = train_db.repeat(20) # æ•°æ®é›†è¿­ä»£ 20 éæ‰ç»ˆæ­¢
```

